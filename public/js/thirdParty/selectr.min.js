(function(root,factory){var plugin="Selectr";if(typeof define==="function"&&define.amd){define([],factory)}else if(typeof exports==="object"){module.exports=factory(plugin)}else{root[plugin]=factory(plugin)}})(this,function(plugin){"use strict";var Events=function(){};Events.prototype={on:function(event,func){this._events=this._events||{};this._events[event]=this._events[event]||[];this._events[event].push(func)},off:function(event,func){this._events=this._events||{};if(event in this._events===false)return;this._events[event].splice(this._events[event].indexOf(func),1)},emit:function(event){this._events=this._events||{};if(event in this._events===false)return;for(var i=0;i<this._events[event].length;i++){this._events[event][i].apply(this,Array.prototype.slice.call(arguments,1))}}};Events.mixin=function(obj){var props=["on","off","emit"];for(var i=0;i<props.length;i++){if(typeof obj==="function"){obj.prototype[props[i]]=Events.prototype[props[i]]}else{obj[props[i]]=Events.prototype[props[i]]}}return obj};var util={escapeRegExp:function(str){var _reRegExpChar=/[\\^$.*+?()[\]{}|]/g;var _reHasRegExpChar=new RegExp(_reRegExpChar.source);return str&&_reHasRegExpChar.test(str)?str.replace(_reRegExpChar,"\\$&"):str},extend:function(src,props){for(var prop in props){if(props.hasOwnProperty(prop)){var val=props[prop];if(val&&Object.prototype.toString.call(val)==="[object Object]"){src[prop]=src[prop]||{};util.extend(src[prop],val)}else{src[prop]=val}}}return src},each:function(a,b,c){if("[object Object]"===Object.prototype.toString.call(a)){for(var d in a){if(Object.prototype.hasOwnProperty.call(a,d)){b.call(c,d,a[d],a)}}}else{for(var e=0,f=a.length;e<f;e++){b.call(c,e,a[e],a)}}},createElement:function(e,a){var d=document,el=d.createElement(e);if(a&&"[object Object]"===Object.prototype.toString.call(a)){var i;for(i in a)if(i in el)el[i]=a[i];else if("html"===i)el.innerHTML=a[i];else el.setAttribute(i,a[i])}return el},hasClass:function(a,b){if(a)return a.classList?a.classList.contains(b):!!a.className&&!!a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))},addClass:function(a,b){if(!util.hasClass(a,b)){if(a.classList){a.classList.add(b)}else{a.className=a.className.trim()+" "+b}}},removeClass:function(a,b){if(util.hasClass(a,b)){if(a.classList){a.classList.remove(b)}else{a.className=a.className.replace(new RegExp("(^|\\s)"+b.split(" ").join("|")+"(\\s|$)","gi")," ")}}},closest:function(el,fn){return el&&el!==document.body&&(fn(el)?el:util.closest(el.parentNode,fn))},isInt:function(val){return typeof val==="number"&&isFinite(val)&&Math.floor(val)===val},debounce:function(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null;if(!c)a.apply(e,f)},h=c&&!d;clearTimeout(d);d=setTimeout(g,b);if(h){a.apply(e,f)}}},rect:function(el,abs){var w=window;var r=el.getBoundingClientRect();var x=abs?w.pageXOffset:0;var y=abs?w.pageYOffset:0;return{bottom:r.bottom+y,height:r.height,left:r.left+x,right:r.right+x,top:r.top+y,width:r.width}},includes:function(a,b){return a.indexOf(b)>-1},startsWith:function(a,b){return a.substr(0,b.length)===b},truncate:function(el){while(el.firstChild){el.removeChild(el.firstChild)}}};function isset(obj,prop){return obj.hasOwnProperty(prop)&&(obj[prop]===true||obj[prop].length)}function appendItem(item,parent,custom){if(item.parentNode){if(!item.parentNode.parentNode){parent.appendChild(item.parentNode)}}else{parent.appendChild(item)}util.removeClass(item,"excluded");if(!custom){item.textContent=item.textContent}}var 
render=function(){if(this.items.length){var f=document.createDocumentFragment();if(this.config.pagination){var pages=this.pages.slice(0,this.pageIndex);util.each(pages,function(i,items){util.each(items,function(j,item){appendItem(item,f,this.customOption)},this)},this)}else{util.each(this.items,function(i,item){appendItem(item,f,this.customOption)},this)}if(f.childElementCount){util.removeClass(this.items[this.navIndex],"active");this.navIndex=(f.querySelector(".selectr-option.selected")||f.querySelector(".selectr-option")).idx;util.addClass(this.items[this.navIndex],"active")}this.tree.appendChild(f)}};var dismiss=function(e){var target=e.target;if(!this.container.contains(target)&&(this.opened||util.hasClass(this.container,"notice"))){this.close()}};var createItem=function(option,data){data=data||option;var elementData={class:"selectr-option",role:"treeitem","aria-selected":false};if(this.customOption){elementData.html=this.config.renderOption(data)}else{elementData.textContent=option.textContent}var opt=util.createElement("li",elementData);opt.idx=option.idx;this.items.push(opt);if(option.defaultSelected){this.defaultSelected.push(option.idx)}if(option.disabled){opt.disabled=true;util.addClass(opt,"disabled")}return opt};var build=function(){this.requiresPagination=this.config.pagination&&this.config.pagination>0;if(isset(this.config,"width")){if(util.isInt(this.config.width)){this.width=this.config.width+"px"}else{if(this.config.width==="auto"){this.width="100%"}else if(util.includes(this.config.width,"%")){this.width=this.config.width}}}this.container=util.createElement("div",{class:"selectr-container"});if(this.config.customClass){util.addClass(this.container,this.config.customClass)}if(this.mobileDevice){util.addClass(this.container,"selectr-mobile")}else{util.addClass(this.container,"selectr-desktop")}this.el.tabIndex=-1;if(this.config.nativeDropdown||this.mobileDevice){util.addClass(this.el,"selectr-visible")}else{util.addClass(this.el,"selectr-hidden")}this.selected=util.createElement("div",{class:"selectr-selected",disabled:this.disabled,tabIndex:0,"aria-expanded":false});this.label=util.createElement(this.el.multiple?"ul":"span",{class:"selectr-label"});var dropdown=util.createElement("div",{class:"selectr-options-container"});this.tree=util.createElement("ul",{class:"selectr-options",role:"tree","aria-hidden":true,"aria-expanded":false});this.notice=util.createElement("div",{class:"selectr-notice"});if(this.mobileDevice||this.nativeDropdown){this.el.setAttribute("aria-hidden",false)}else{this.el.setAttribute("aria-hidden",true)}if(this.disabled){this.el.disabled=true}if(this.el.multiple){util.addClass(this.label,"selectr-tags");util.addClass(this.container,"multiple");this.tags=[];this.selectedValues=this.config.defaultSelected?this.getSelectedProperties("value"):[];this.selectedIndexes=this.getSelectedProperties("idx")}else{this.selectedValue=null;this.selectedIndex=-1}this.selected.appendChild(this.label);if(this.config.clearable){this.selectClear=util.createElement("button",{class:"selectr-clear",type:"button"});this.container.appendChild(this.selectClear);util.addClass(this.container,"clearable")}if(this.config.taggable){var li=util.createElement("li",{class:"input-tag"});this.input=util.createElement("input",{class:"selectr-tag-input",placeholder:this.config.tagPlaceholder,tagIndex:0,autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",role:"textbox",type:"search"});li.appendChild(this.input);this.label.appendChild(li);util.addClass(this.container,"taggable");this.tagSeperators=[","];if(this.config.tagSeperators){this.tagSeperators=this.tagSeperators.concat(this.config.tagSeperators);var _aTempEscapedSeperators=[];for(var _nTagSeperatorStepCount=0;_nTagSeperatorStepCount<this.tagSeperators.length;_nTagSeperatorStepCount++){_aTempEscapedSeperators.push(util.escapeRegExp(this.tagSeperators[_nTagSeperatorStepCount]))}this.tagSeperatorsRegex=new RegExp(_aTempEscapedSeperators.join("|"),"i")}else{this.tagSeperatorsRegex=new RegExp(",","i")}}if(this.config.searchable){this.input=util.createElement("input",{class:"selectr-input",tagIndex:-1,autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",role:"textbox",type:"search",placeholder:this.config.messages.searchPlaceholder});this.inputClear=util.createElement("button",{class:"selectr-input-clear",type:"button"});this.inputContainer=util.createElement("div",{class:"selectr-input-container"});this.inputContainer.appendChild(this.input);this.inputContainer.appendChild(this.inputClear);dropdown.appendChild(this.inputContainer)}dropdown.appendChild(this.notice);dropdown.appendChild(this.tree);this.items=[];this.options=[];if(this.el.options.length){this.options=[].slice.call(this.el.options)}var group=false,j=0;if(this.el.children.length){util.each(this.el.children,function(i,element){if(element.nodeName==="OPTGROUP"){group=util.createElement("ul",{class:"selectr-optgroup",role:"group",html:"<li class='selectr-optgroup--label'>"+element.label+"</li>"});util.each(element.children,function(x,el){el.idx=j;group.appendChild(createItem.call(this,el,group));j++},this)}else{element.idx=j;createItem.call(this,element);j++}},this)}if(this.config.data&&Array.isArray(this.config.data)){this.data=[];var optgroup=false,option;group=false;j=0;util.each(this.config.data,function(i,opt){if(isset(opt,"children")){optgroup=util.createElement("optgroup",{label:opt.text});group=util.createElement("ul",{class:"selectr-optgroup",role:"group",html:"<li class='selectr-optgroup--label'>"+opt.text+"</li>"});util.each(opt.children,function(x,data){option=new Option(data.text,data.value,false,data.hasOwnProperty("selected")&&data.selected===true);option.disabled=isset(data,"disabled");this.options.push(option);optgroup.appendChild(option);option.idx=j;group.appendChild(createItem.call(this,option,data));this.data[j]=data;j++},this);this.el.appendChild(optgroup)}else{option=new Option(opt.text,opt.value,false,opt.hasOwnProperty("selected")&&opt.selected===true);option.disabled=isset(opt,"disabled");this.options.push(option);option.idx=j;createItem.call(this,option,opt);this.data[j]=opt;j++}},this)}this.setSelected(true);var first;this.navIndex=0;for(var i=0;i<this.items.length;i++){first=this.items[i];if(!util.hasClass(first,"disabled")){util.addClass(first,"active");this.navIndex=i;break}}if(this.requiresPagination){this.pageIndex=1;this.paginate()}this.container.appendChild(this.selected);this.container.appendChild(dropdown);this.placeEl=util.createElement("div",{class:"selectr-placeholder"});this.setPlaceholder();this.selected.appendChild(this.placeEl);if(this.disabled){this.disable()}this.el.parentNode.insertBefore(this.container,this.el);this.container.appendChild(this.el)};var navigate=function(e){e=e||window.event;if(!this.items.length||!this.opened||!util.includes([13,38,40],e.which)){this.navigating=false;return}e.preventDefault();if(e.which===13){if(this.noResults||this.config.taggable&&this.input.value.length>0){return false}return this.change(this.navIndex)}var direction,prevEl=this.items[this.navIndex];var lastIndex=this.navIndex;switch(e.which){case 38:direction=0;if(this.navIndex>0){this.navIndex--}break;case 40:direction=1;if(this.navIndex<this.items.length-1){this.navIndex++}}this.navigating=true;while(util.hasClass(this.items[this.navIndex],"disabled")||util.hasClass(this.items[this.navIndex],"excluded")){if(this.navIndex>0&&this.navIndex<this.items.length-1){if(direction){this.navIndex++}else{this.navIndex--}}else{this.navIndex=lastIndex;break}if(this.searching){if(this.navIndex>this.tree.lastElementChild.idx){this.navIndex=this.tree.lastElementChild.idx;break}else if(this.navIndex<this.tree.firstElementChild.idx){this.navIndex=this.tree.firstElementChild.idx;break}}}var r=util.rect(this.items[this.navIndex]);if(!direction){if(this.navIndex===0){this.tree.scrollTop=0}else if(r.top-this.optsRect.top<0){this.tree.scrollTop=this.tree.scrollTop+(r.top-this.optsRect.top)}}else{if(this.navIndex===0){this.tree.scrollTop=0}else if(r.top+r.height>this.optsRect.top+this.optsRect.height){this.tree.scrollTop=this.tree.scrollTop+(r.top+r.height-(this.optsRect.top+this.optsRect.height))}if(this.navIndex===this.tree.childElementCount-1&&this.requiresPagination){load.call(this)}}if(prevEl){util.removeClass(prevEl,"active")}util.addClass(this.items[this.navIndex],"active")};var addTag=function(item){var that=this,r;var docFrag=document.createDocumentFragment();var option=this.options[item.idx];var data=this.data?this.data[item.idx]:option;var elementData={class:"selectr-tag"};if(this.customSelected){elementData.html=this.config.renderSelection(data)}else{elementData.textContent=option.textContent}var tag=util.createElement("li",elementData);var btn=util.createElement("button",{class:"selectr-tag-remove",type:"button"});tag.appendChild(btn);tag.idx=item.idx;tag.tag=option.value;this.tags.push(tag);if(this.config.sortSelected){var tags=this.tags.slice();r=function(val,arr){val.replace(/(\d+)|(\D+)/g,function(that,$1,$2){arr.push([$1||Infinity,$2||""])})};tags.sort(function(a,b){var x=[],y=[],ac,bc;if(that.config.sortSelected===true){ac=a.tag;bc=b.tag}else if(that.config.sortSelected==="text"){ac=a.textContent;bc=b.textContent}r(ac,x);r(bc,y);while(x.length&&y.length){var ax=x.shift();var by=y.shift();var nn=ax[0]-by[0]||ax[1].localeCompare(by[1]);if(nn)return nn}return x.length-y.length});util.each(tags,function(i,tg){docFrag.appendChild(tg)});this.label.innerHTML=""}else{docFrag.appendChild(tag)}if(this.config.taggable){this.label.insertBefore(docFrag,this.input.parentNode)}else{this.label.appendChild(docFrag)}};var removeTag=function(item){var tag=false;util.each(this.tags,function(i,t){if(t.idx===item.idx){tag=t}},this);if(tag){this.label.removeChild(tag);this.tags.splice(this.tags.indexOf(tag),1)}};var load=function(){var tree=this.tree;var scrollTop=tree.scrollTop;var scrollHeight=tree.scrollHeight;var offsetHeight=tree.offsetHeight;var atBottom=scrollTop>=scrollHeight-offsetHeight;if(atBottom&&this.pageIndex<this.pages.length){var f=document.createDocumentFragment();util.each(this.pages[this.pageIndex],function(i,item){appendItem(item,f,this.customOption)},this);tree.appendChild(f);this.pageIndex++;this.emit("selectr.paginate",{items:this.items.length,total:this.data.length,page:this.pageIndex,pages:this.pages.length})}};var clearSearch=function(){if(this.config.searchable||this.config.taggable){this.input.value=null;this.searching=false;if(this.config.searchable){util.removeClass(this.inputContainer,"active")}if(util.hasClass(this.container,"notice")){util.removeClass(this.container,"notice");util.addClass(this.container,"open");this.input.focus()}util.each(this.items,function(i,item){util.removeClass(item,"excluded");if(!this.customOption){item.textContent=item.textContent}},this)}};var match=function(query,option){var text=option.textContent;var RX=new RegExp(query,"ig");var result=RX.exec(text);if(result){option.innerHTML="";var span=document.createElement("span");span.classList.add("selectr-match");span.textContent=result[0];option.appendChild(document.createTextNode(text.substring(0,result.index)));option.appendChild(span);option.appendChild(document.createTextNode(text.substring(RX.lastIndex)));return true}return false};var Selectr=function(el,config){if(!el){throw new Error("You must supply either a HTMLSelectElement or a CSS3 selector string.")}this.el=el;if(typeof el==="string"){this.el=document.querySelector(el)}if(this.el===null){throw new Error("The element you passed to Selectr can not be found.")}if(this.el.nodeName.toLowerCase()!=="select"){throw new Error("The element you passed to Selectr is not a HTMLSelectElement.")}this.render(config)};Selectr.prototype.render=function(config){if(this.rendered)return;var defaultConfig={defaultSelected:true,width:"auto",disabled:false,disabledMobile:false,searchable:true,clearable:false,sortSelected:false,allowDeselect:false,closeOnScroll:false,nativeDropdown:false,nativeKeyboard:false,placeholder:"Select an option...",taggable:false,tagPlaceholder:"Enter a tag...",messages:{noResults:"No results.",noOptions:"No options available.",maxSelections:"A maximum of {max} items can be selected.",tagDuplicate:"That tag is already in use.",searchPlaceholder:"Search options..."}};this.el.selectr=this;this.config=util.extend(defaultConfig,config);this.originalType=this.el.type;this.originalIndex=this.el.tabIndex;this.defaultSelected=[];this.originalOptionCount=this.el.options.length;if(this.config.multiple||this.config.taggable){this.el.multiple=true}this.disabled=isset(this.config,"disabled");this.opened=false;if(this.config.taggable){this.config.searchable=false}this.navigating=false;this.mobileDevice=false;if(!this.config.disabledMobile&&/Android|webOS|iPhone|iPad|BlackBerry|Windows Phone|Opera Mini|IEMobile|Mobile/i.test(navigator.userAgent)){this.mobileDevice=true}this.customOption=this.config.hasOwnProperty("renderOption")&&typeof this.config.renderOption==="function";this.customSelected=this.config.hasOwnProperty("renderSelection")&&typeof this.config.renderSelection==="function";this.supportsEventPassiveOption=this.detectEventPassiveOption();Events.mixin(this);build.call(this);this.bindEvents();this.update();this.optsRect=util.rect(this.tree);this.rendered=true;if(!this.el.multiple){this.el.selectedIndex=this.selectedIndex}var that=this;setTimeout(function(){that.emit("selectr.init")},20)};Selectr.prototype.getSelected=function(){var selected=this.el.querySelectorAll("option:checked");return selected};Selectr.prototype.getSelectedProperties=function(prop){var selected=this.getSelected();var values=[].slice.call(selected).map(function(option){return option[prop]}).filter(function(i){return i!==null&&i!==undefined});return values};Selectr.prototype.detectEventPassiveOption=function(){var supportsPassiveOption=false;try{var opts=Object.defineProperty({},"passive",{get:function(){supportsPassiveOption=true}});window.addEventListener("test",null,opts)}catch(e){}return supportsPassiveOption};Selectr.prototype.bindEvents=function(){var that=this;this.events={};this.events.dismiss=dismiss.bind(this);this.events.navigate=navigate.bind(this);this.events.reset=this.reset.bind(this);if(this.config.nativeDropdown||this.mobileDevice){this.container.addEventListener("touchstart",function(e){if(e.changedTouches[0].target===that.el){that.toggle()}},this.supportsEventPassiveOption?{passive:true}:false);this.container.addEventListener("click",function(e){if(e.target===that.el){that.toggle()}});var getChangedOptions=function(last,current){var added=[],removed=last.slice(0);var idx;for(var i=0;i<current.length;i++){idx=removed.indexOf(current[i]);if(idx>-1)removed.splice(idx,1);else added.push(current[i])}return[added,removed]};this.el.addEventListener("change",function(e){if(e.__selfTriggered){return}if(that.el.multiple){var indexes=that.getSelectedProperties("idx");var changes=getChangedOptions(that.selectedIndexes,indexes);util.each(changes[0],function(i,idx){that.select(idx)},that);util.each(changes[1],function(i,idx){that.deselect(idx)},that)}else{if(that.el.selectedIndex>-1){that.select(that.el.selectedIndex)}}})}if(this.config.nativeDropdown){this.container.addEventListener("keydown",function(e){if(e.key==="Enter"&&that.selected===document.activeElement){that.toggle();setTimeout(function(){that.el.focus()},200)}})}this.selected.addEventListener("click",function(e){if(!that.disabled){that.toggle()}e.preventDefault()});if(this.config.nativeKeyboard){var typing="";var typingTimeout=null;this.selected.addEventListener("keydown",function(e){if(that.disabled||that.selected!==document.activeElement||(e.altKey||e.ctrlKey||e.metaKey)){return}if(e.key===" "||!that.opened&&["Enter","ArrowUp","ArrowDown"].indexOf(e.key)>-1){that.toggle();e.preventDefault();e.stopPropagation();return}if(e.key.length<=2&&String[String.fromCodePoint?"fromCodePoint":"fromCharCode"](e.key[String.codePointAt?"codePointAt":"charCodeAt"](0))===e.key){if(that.config.multiple){that.open();if(that.config.searchable){that.input.value=e.key;that.input.focus();that.search(null,true)}}else{if(typingTimeout){clearTimeout(typingTimeout)}typing+=e.key;var found=that.search(typing,true);if(found&&found.length){that.clear();that.setValue(found[0].value)}setTimeout(function(){typing=""},1e3)}e.preventDefault();e.stopPropagation();return}});this.container.addEventListener("keyup",function(e){if(that.opened&&e.key==="Escape"){that.close();e.stopPropagation();that.selected.focus()}})}this.label.addEventListener("click",function(e){if(util.hasClass(e.target,"selectr-tag-remove")){that.deselect(e.target.parentNode.idx)}});if(this.selectClear){this.selectClear.addEventListener("click",this.clear.bind(this))}this.tree.addEventListener("mousedown",function(e){e.preventDefault()});this.tree.addEventListener("click",function(e){var item=util.closest(e.target,function(el){return el&&util.hasClass(el,"selectr-option")});if(item){if(!util.hasClass(item,"disabled")){if(util.hasClass(item,"selected")){if(that.el.multiple||!that.el.multiple&&that.config.allowDeselect){that.deselect(item.idx)}}else{that.select(item.idx)}if(that.opened&&!that.el.multiple){that.close()}}}e.preventDefault();e.stopPropagation()});this.tree.addEventListener("mouseover",function(e){if(util.hasClass(e.target,"selectr-option")){if(!util.hasClass(e.target,"disabled")){util.removeClass(that.items[that.navIndex],"active");util.addClass(e.target,"active");that.navIndex=[].slice.call(that.items).indexOf(e.target)}}});if(this.config.searchable){this.input.addEventListener("focus",function(e){that.searching=true});this.input.addEventListener("blur",function(e){that.searching=false});this.input.addEventListener("keyup",function(e){that.search();if(!that.config.taggable){if(this.value.length){util.addClass(this.parentNode,"active")}else{util.removeClass(this.parentNode,"active")}}});this.inputClear.addEventListener("click",function(e){that.input.value=null;clearSearch.call(that);if(!that.tree.childElementCount){render.call(that)}})}if(this.config.taggable){this.input.addEventListener("keyup",function(e){that.search();if(that.config.taggable&&this.value.length){var _sVal=this.value.trim();if(_sVal.length&&(e.which===13||that.tagSeperatorsRegex.test(_sVal))){var _sGrabbedTagValue=_sVal.replace(that.tagSeperatorsRegex,"");_sGrabbedTagValue=util.escapeRegExp(_sGrabbedTagValue);_sGrabbedTagValue=_sGrabbedTagValue.trim();var _oOption;if(_sGrabbedTagValue.length){_oOption=that.add({value:_sGrabbedTagValue,textContent:_sGrabbedTagValue,selected:true},true)}if(_oOption){that.close();clearSearch.call(that)}else{this.value="";that.setMessage(that.config.messages.tagDuplicate)}}}})}this.update=util.debounce(function(){if(that.opened&&that.config.closeOnScroll){that.close()}if(that.width){that.container.style.width=that.width}that.invert()},50);if(this.requiresPagination){this.paginateItems=util.debounce(function(){load.call(this)},50);this.tree.addEventListener("scroll",this.paginateItems.bind(this))}document.addEventListener("click",this.events.dismiss);window.addEventListener("keydown",this.events.navigate);window.addEventListener("resize",this.update);window.addEventListener("scroll",this.update);this.on("selectr.destroy",function(){document.removeEventListener("click",this.events.dismiss);window.removeEventListener("keydown",this.events.navigate);window.removeEventListener("resize",this.update);window.removeEventListener("scroll",this.update)});if(this.el.form){this.el.form.addEventListener("reset",this.events.reset);this.on("selectr.destroy",function(){this.el.form.removeEventListener("reset",this.events.reset)})}};Selectr.prototype.setSelected=function(reset){if(!this.config.data&&!this.el.multiple&&this.el.options.length){if(this.el.selectedIndex===0){if(!this.el.options[0].defaultSelected&&!this.config.defaultSelected){this.el.selectedIndex=-1}}this.selectedIndex=this.el.selectedIndex;if(this.selectedIndex>-1){this.select(this.selectedIndex)}}if(this.config.multiple&&this.originalType==="select-one"&&!this.config.data){if(this.el.options[0].selected&&!this.el.options[0].defaultSelected){this.el.options[0].selected=false}}util.each(this.options,function(i,option){if(option.selected&&option.defaultSelected){this.select(option.idx)}},this);if(this.config.selectedValue){this.setValue(this.config.selectedValue)}if(this.config.data){if(!this.el.multiple&&this.config.defaultSelected&&this.el.selectedIndex<0&&this.config.data.length>0){this.select(0)}var j=0;util.each(this.config.data,function(i,opt){if(isset(opt,"children")){util.each(opt.children,function(x,item){if(item.hasOwnProperty("selected")&&item.selected===true){this.select(j)}j++},this)}else{if(opt.hasOwnProperty("selected")&&opt.selected===true){this.select(j)}j++}},this)}};Selectr.prototype.destroy=function(){if(!this.rendered)return;this.emit("selectr.destroy");if(this.originalType==="select-one"){this.el.multiple=false}if(this.config.data){this.el.innerHTML=""}util.removeClass(this.el,"selectr-hidden");this.container.parentNode.replaceChild(this.el,this.container);this.rendered=false;delete this.el.selectr};Selectr.prototype.change=function(index){var item=this.items[index],option=this.options[index];if(option.disabled){return}if(option.selected&&util.hasClass(item,"selected")){this.deselect(index)}else{this.select(index)}if(this.opened&&!this.el.multiple){this.close()}};Selectr.prototype.select=function(index){var item=this.items[index],options=[].slice.call(this.el.options),option=this.options[index];if(this.el.multiple){if(util.includes(this.selectedIndexes,index)){return false}if(this.config.maxSelections&&this.tags.length===this.config.maxSelections){this.setMessage(this.config.messages.maxSelections.replace("{max}",this.config.maxSelections),true);return false}this.selectedValues.push(option.value);this.selectedIndexes.push(index);addTag.call(this,item)}else{var data=this.data?this.data[index]:option;if(this.customSelected){this.label.innerHTML=this.config.renderSelection(data)}else{this.label.textContent=option.textContent}this.selectedValue=option.value;this.selectedIndex=index;util.each(this.options,function(i,o){var opt=this.items[i];if(i!==index){if(opt){util.removeClass(opt,"selected")}o.selected=false;o.removeAttribute("selected")}},this)}if(!util.includes(options,option)){this.el.add(option)}item.setAttribute("aria-selected",true);util.addClass(item,"selected");util.addClass(this.container,"has-selected");option.selected=true;option.setAttribute("selected","");this.emit("selectr.change",option);this.emit("selectr.select",option);if("createEvent"in document){var evt=document.createEvent("HTMLEvents");evt.initEvent("change",true,true);evt.__selfTriggered=true;this.el.dispatchEvent(evt)}else{this.el.fireEvent("onchange")}};Selectr.prototype.deselect=function(index,force){var item=this.items[index],option=this.options[index];if(this.el.multiple){var selIndex=this.selectedIndexes.indexOf(index);this.selectedIndexes.splice(selIndex,1);var valIndex=this.selectedValues.indexOf(option.value);this.selectedValues.splice(valIndex,1);removeTag.call(this,item);if(!this.tags.length){util.removeClass(this.container,"has-selected")}}else{if(!force&&!this.config.clearable&&!this.config.allowDeselect){return false}this.label.innerHTML="";this.selectedValue=null;this.el.selectedIndex=this.selectedIndex=-1;util.removeClass(this.container,"has-selected")}this.items[index].setAttribute("aria-selected",false);util.removeClass(this.items[index],"selected");option.selected=false;option.removeAttribute("selected");this.emit("selectr.change",null);this.emit("selectr.deselect",option);if("createEvent"in document){var evt=document.createEvent("HTMLEvents");evt.initEvent("change",true,true);evt.__selfTriggered=true;this.el.dispatchEvent(evt)}else{this.el.fireEvent("onchange")}};Selectr.prototype.setValue=function(value){var isArray=Array.isArray(value);if(!isArray){value=value.toString().trim()}if(!this.el.multiple&&isArray){return false}util.each(this.options,function(i,option){if(isArray&&value.indexOf(option.value)>-1||option.value===value){this.change(option.idx)}},this)};Selectr.prototype.getValue=function(toObject,toJson){var value;if(this.el.multiple){if(toObject){if(this.selectedIndexes.length){value={};value.values=[];util.each(this.selectedIndexes,function(i,index){var option=this.options[index];value.values[i]={value:option.value,text:option.textContent}},this)}}else{value=this.selectedValues.slice()}}else{if(toObject){var option=this.options[this.selectedIndex];value={value:option.value,text:option.textContent}}else{value=this.selectedValue}}if(toObject&&toJson){value=JSON.stringify(value)}return value};Selectr.prototype.add=function(data,checkDuplicate){if(data){this.data=this.data||[];this.items=this.items||[];this.options=this.options||[];if(Array.isArray(data)){util.each(data,function(i,obj){this.add(obj,checkDuplicate)},this)}else if("[object Object]"===Object.prototype.toString.call(data)){if(checkDuplicate){var dupe=false;util.each(this.options,function(i,option){if(option.value.toLowerCase()===data.value.toLowerCase()){dupe=true}});if(dupe){return false}}var option=util.createElement("option",data);this.data.push(data);if(this.mobileDevice){this.el.add(option)}this.options.push(option);option.idx=this.options.length>0?this.options.length-1:0;createItem.call(this,option);if(data.selected){this.select(option.idx)}this.setPlaceholder();return option}if(this.config.pagination){this.paginate()}return true}};Selectr.prototype.remove=function(o){var options=[];if(Array.isArray(o)){util.each(o,function(i,opt){if(util.isInt(opt)){options.push(this.getOptionByIndex(opt))}else if(typeof opt==="string"){options.push(this.getOptionByValue(opt))}},this)}else if(util.isInt(o)){options.push(this.getOptionByIndex(o))}else if(typeof o==="string"){options.push(this.getOptionByValue(o))}if(options.length){var index;util.each(options,function(i,option){index=option.idx;this.el.remove(option);this.options.splice(index,1);var parentNode=this.items[index].parentNode;if(parentNode){parentNode.removeChild(this.items[index])}this.items.splice(index,1);util.each(this.options,function(i,opt){opt.idx=i;this.items[i].idx=i},this)},this);this.setPlaceholder();if(this.config.pagination){this.paginate()}}};Selectr.prototype.removeAll=function(){this.clear(true);util.each(this.el.options,function(i,option){this.el.remove(option)},this);util.truncate(this.tree);this.items=[];this.options=[];this.data=[];this.navIndex=0;if(this.requiresPagination){this.requiresPagination=false;this.pageIndex=1;this.pages=[]}this.setPlaceholder()};Selectr.prototype.search=function(string,anchor){if(this.navigating){return}var live=false;if(!string){string=this.input.value;live=true;this.removeMessage();util.truncate(this.tree)}var results=[];var f=document.createDocumentFragment();string=string.trim().toLowerCase();if(string.length>0){var compare=anchor?util.startsWith:util.includes;util.each(this.options,function(i,option){var item=this.items[option.idx];var matches=compare(option.textContent.trim().toLowerCase().replace(/-|\s/g,""),string.replace(/-|\s/g,""));if(matches&&!option.disabled){results.push({text:option.textContent,value:option.value});if(live){appendItem(item,f,this.customOption);util.removeClass(item,"excluded");if(!this.customOption){match(string,option)}}}else if(live){util.addClass(item,"excluded")}},this);if(live){if(!f.childElementCount){if(!this.config.taggable){this.noResults=true;this.setMessage(this.config.messages.noResults)}}else{var prevEl=this.items[this.navIndex];var firstEl=f.querySelector(".selectr-option:not(.excluded)");this.noResults=false;util.removeClass(prevEl,"active");this.navIndex=firstEl.idx;util.addClass(firstEl,"active")}this.tree.appendChild(f)}}else{render.call(this)}return results};Selectr.prototype.toggle=function(){if(!this.disabled){if(this.opened){this.close()}else{this.open()}}};Selectr.prototype.open=function(){var that=this;if(!this.options.length){return false}if(!this.opened){this.emit("selectr.open")}this.opened=true;if(this.mobileDevice||this.config.nativeDropdown){util.addClass(this.container,"native-open");if(this.config.data&&this.el.options.length===0){util.each(this.options,function(i,option){this.el.add(option)},this)}return}util.addClass(this.container,"open");render.call(this);this.invert();this.tree.scrollTop=0;util.removeClass(this.container,"notice");this.selected.setAttribute("aria-expanded",true);this.tree.setAttribute("aria-hidden",false);this.tree.setAttribute("aria-expanded",true);if(this.config.searchable&&!this.config.taggable){setTimeout(function(){that.input.focus();that.input.tabIndex=0},10)}};Selectr.prototype.close=function(){if(this.opened){this.emit("selectr.close")}this.opened=false;this.navigating=false;if(this.mobileDevice||this.config.nativeDropdown){util.removeClass(this.container,"native-open");return}var notice=util.hasClass(this.container,"notice");if(this.config.searchable&&!notice){this.input.blur();this.input.tabIndex=-1;this.searching=false}if(notice){util.removeClass(this.container,"notice");this.notice.textContent=""}util.removeClass(this.container,"open");util.removeClass(this.container,"native-open");this.selected.setAttribute("aria-expanded",false);this.tree.setAttribute("aria-hidden",true);this.tree.setAttribute("aria-expanded",false);util.truncate(this.tree);clearSearch.call(this)};Selectr.prototype.enable=function(){this.disabled=false;this.el.disabled=false;this.selected.tabIndex=this.originalIndex;if(this.el.multiple){util.each(this.tags,function(i,t){t.lastElementChild.tabIndex=0})}util.removeClass(this.container,"selectr-disabled")};Selectr.prototype.disable=function(container){if(!container){this.el.disabled=true}this.selected.tabIndex=-1;if(this.el.multiple){util.each(this.tags,function(i,t){t.lastElementChild.tabIndex=-1})}this.disabled=true;util.addClass(this.container,"selectr-disabled")};Selectr.prototype.reset=function(){if(!this.disabled){this.clear();this.setSelected(true);util.each(this.defaultSelected,function(i,idx){this.select(idx)},this);this.emit("selectr.reset")}};Selectr.prototype.clear=function(force,isClearLast){if(this.el.multiple){if(this.selectedIndexes.length){var indexes=this.selectedIndexes.slice();if(isClearLast){this.deselect(indexes.slice(-1)[0])}else{util.each(indexes,function(i,idx){this.deselect(idx)},this)}}}else{if(this.selectedIndex>-1){this.deselect(this.selectedIndex,force)}}this.emit("selectr.clear")};Selectr.prototype.serialise=function(toJson){var data=[];util.each(this.options,function(i,option){var obj={value:option.value,text:option.textContent};if(option.selected){obj.selected=true}if(option.disabled){obj.disabled=true}data[i]=obj});return toJson?JSON.stringify(data):data};Selectr.prototype.serialize=function(toJson){return this.serialise(toJson)};Selectr.prototype.setPlaceholder=function(placeholder){placeholder=placeholder||this.config.placeholder||this.el.getAttribute("placeholder");if(!this.options.length){placeholder=this.config.messages.noOptions}this.placeEl.innerHTML=placeholder};Selectr.prototype.paginate=function(){if(this.items.length){var that=this;this.pages=this.items.map(function(v,i){return i%that.config.pagination===0?that.items.slice(i,i+that.config.pagination):null}).filter(function(pages){return pages});return this.pages}};Selectr.prototype.setMessage=function(message,close){if(close){this.close()}util.addClass(this.container,"notice");this.notice.textContent=message};Selectr.prototype.removeMessage=function(){util.removeClass(this.container,"notice");this.notice.innerHTML=""};Selectr.prototype.invert=function(){var rt=util.rect(this.selected),oh=this.tree.parentNode.offsetHeight,wh=window.innerHeight,doInvert=rt.top+rt.height+oh>wh;if(doInvert){util.addClass(this.container,"inverted");this.isInverted=true}else{util.removeClass(this.container,"inverted");this.isInverted=false}this.optsRect=util.rect(this.tree)};Selectr.prototype.getOptionByIndex=function(index){return this.options[index]};Selectr.prototype.getOptionByValue=function(value){var option=false;for(var i=0,l=this.options.length;i<l;i++){if(this.options[i].value.trim()===value.toString().trim()){option=this.options[i];break}}return option};return Selectr});